# PR Description - Issue #54

Issue: #54 - Create end-to-end interactive debug automation against live Dyalog  
Branch: codex/54-create-end-to-end-interactive-debug-automation-against-live-dyalog  
Plan reference: /Users/stefan/work/lsp-dap/docs/plans/ride-protocol.md (live verification strategy)  
Context references: /Users/stefan/work/lsp-dap/README.md, parent epic #45

## Summary

This change adds a real adapter-bound, live Dyalog interactive E2E automation scenario (initialize, launch, stopped, threads/stack/scopes/variables, step, continue, disconnect) with deterministic artifact capture and flake classification.

It also wires CI and documentation for controlled enforcement via environment flags.

## Why this change

Issue #54 required moving beyond smoke-only live checks to prove interactive debugging workflows through the actual DAP stdio boundary.

This implementation provides an env-gated E2E path suitable for CI environments that can supply deterministic live setup.

## Scope of changes

Files changed:

- `/Users/stefan/work/lsp-dap/cmd/dap-adapter/live_e2e_test.go`
- `/Users/stefan/work/lsp-dap/cmd/dap-adapter/live_e2e_policy_test.go`
- `/Users/stefan/work/lsp-dap/.github/workflows/ci.yml`
- `/Users/stefan/work/lsp-dap/docs/validations/54-live-e2e-flake-policy.md`
- `/Users/stefan/work/lsp-dap/scaffold_test.go`
- `/Users/stefan/work/lsp-dap/README.md`

### New live interactive workflow test

Added `TestLiveDAPAdapter_InteractiveWorkflow`:

- requires `DYALOG_E2E_REQUIRE=1` (otherwise explicit skip)
- runs against real adapter process boundary (`run(...)` stdio)
- validates interactive sequence:
  - `initialize`
  - `launch`
  - wait `stopped`
  - `threads`
  - `stackTrace`
  - `scopes`
  - `variables`
  - `next`
  - `continue`
  - `disconnect`

### Deterministic artifact capture

The live E2E test now writes JSONL DAP traces to:

- `artifacts/integration/live-e2e/*.jsonl`

Failure paths include artifact location in test error output.

### Flake classification policy

Added classification function + policy doc with classes:

- `infrastructure-flake`
- `scenario-precondition`
- `product-defect`

Added unit tests for classifier behavior (`live_e2e_policy_test.go`).

### CI updates

Updated live CI job environment:

- `DYALOG_E2E_REQUIRE` from repository vars
- `DYALOG_E2E_TIMEOUT` from repository vars

Added artifact upload step (`actions/upload-artifact`) for:

- `artifacts/integration`

This runs with `if: always()` so failures retain diagnostics.

### Scaffold and docs

Added scaffold assertions for:

- CI E2E env/plumbing
- live E2E test presence
- flake policy documentation

README now includes:

- command/example env for running live interactive E2E workflow
- policy doc reference

## Validation performed

Commands run:

- `go test ./cmd/dap-adapter -count=1`
- `go test ./... -count=1`
- `go vet ./...`

Result:

- all checks pass locally
- live interactive E2E test is env-gated by design and skips unless `DYALOG_E2E_REQUIRE=1`

## Compatibility and risk

Behavioral impact:

- no production adapter runtime logic changed
- test/CI/docs enhancements only

Risk:

- low; primary risk is environment readiness for live E2E enforcement when enabled

## Reviewer guide

Suggested review order:

1. `/Users/stefan/work/lsp-dap/cmd/dap-adapter/live_e2e_test.go`
2. `/Users/stefan/work/lsp-dap/.github/workflows/ci.yml`
3. `/Users/stefan/work/lsp-dap/docs/validations/54-live-e2e-flake-policy.md`
4. `/Users/stefan/work/lsp-dap/scaffold_test.go`
