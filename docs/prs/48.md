# PR Description - Issue #48

Issue: #48 - Add guided setup commands and diagnostics UX in extension  
Branch: codex/48-add-guided-setup-commands-and-diagnostics-ux-in-extension  
Plan reference: /Users/stefan/work/lsp-dap/docs/plans/ride-protocol.md (productization and usability context)  
Context references: /Users/stefan/work/lsp-dap/README.md, parent epic #43

## Summary

This change adds guided setup/validation commands to the VS Code extension and introduces a dedicated `Dyalog DAP` output channel with structured diagnostics and a verbosity toggle.

The result is better first-run UX and clearer remediation for common misconfiguration cases (missing adapter binary, malformed `rideAddr`, missing launch config).

## Why this change

Issue #48 called out user friction when debugging setup is incorrect. Previously, failures surfaced as generic errors with little guidance.

This implementation adds command-driven helpers and explicit action-oriented error messages so users can self-recover quickly.

## Scope of changes

Files changed:

- `/Users/stefan/work/lsp-dap/scaffold_test.go`
- `/Users/stefan/work/lsp-dap/vscode-extension/package.json`
- `/Users/stefan/work/lsp-dap/vscode-extension/src/extension.ts`
- `/Users/stefan/work/lsp-dap/vscode-extension/src/setup.ts`
- `/Users/stefan/work/lsp-dap/vscode-extension/src/test/setup.test.ts`
- `/Users/stefan/work/lsp-dap/vscode-extension/out/extension.js`
- `/Users/stefan/work/lsp-dap/vscode-extension/out/setup.js`
- `/Users/stefan/work/lsp-dap/vscode-extension/README.md`
- `/Users/stefan/work/lsp-dap/README.md`

### New extension commands

Added command registrations and `package.json` contributions:

- `dyalogDap.setupLaunchConfig`
- `dyalogDap.validateAdapterPath`
- `dyalogDap.validateRideAddr`
- `dyalogDap.toggleDiagnosticsVerbose`

Each command has:

- command palette title
- `onCommand:*` activation event

### Diagnostics channel and verbosity control

Extension activation now creates a dedicated `Dyalog DAP` output channel.

Structured diagnostics are emitted for:

- extension activation
- adapter spawn attempts
- adapter resolution failures
- setup/validation command actions

Added extension setting:

- `dyalogDap.diagnostics.verbose` (boolean, default `false`)

Debug-level diagnostics are only emitted when verbose mode is enabled.

### Guided setup/validation helpers

Added `src/setup.ts` helper module:

- `starterLaunchConfiguration`
- `ensureLaunchConfigText`
- `validateAdapterPathCandidate`
- `validateRideAddress`

`Setup Launch Configuration` command:

- creates/updates `.vscode/launch.json`
- appends starter `dyalog-dap` launch config if missing
- leaves existing dyalog config untouched (idempotent behavior)
- supports JSONC-style comments/trailing commas in existing `launch.json`
- avoids destructive overwrite when syntax is unrecoverably invalid

`Validate Adapter Path` command:

- prompts user for path (default from workspace discovery)
- validates existence and returns fix guidance (`go build`, `DYALOG_DAP_ADAPTER_PATH`)

`Validate RIDE Address` command:

- validates `host:port` formatting and numeric port range

Adapter startup error message now includes actionable recovery path:

- run `Dyalog DAP: Validate Adapter Path`
- set `adapterPath`
- or set `DYALOG_DAP_ADAPTER_PATH`

### Tests

Added scaffold tests for:

- command contributions and activation events
- diagnostics verbosity setting in extension manifest
- output channel + command wiring in extension source

Added extension unit tests (`src/test/setup.test.ts`) for:

- starter config generation
- `rideAddr` validation
- adapter path validation messaging
- launch.json creation/append/idempotency logic

## Validation performed

Commands run:

- `go test ./... -count=1`
- `go vet ./...`
- `cd /Users/stefan/work/lsp-dap/vscode-extension && npm run lint && npm run test && npm run build`
- `cd /Users/stefan/work/lsp-dap/vscode-extension && npm run package:vsix`

Result:

- all checks pass
- VSIX artifact builds successfully with new setup/diagnostic UX included

## Compatibility and risk

Behavioral impact:

- extension now exposes additional commands/settings
- adapter startup failures present clearer suggestions
- no DAP protocol semantics changed

Risk:

- low; mainly extension UX and diagnostics improvements
- validation currently checks format/path existence (not live network probe for `rideAddr`)

## Reviewer guide

Suggested review order:

1. `/Users/stefan/work/lsp-dap/vscode-extension/src/setup.ts`
2. `/Users/stefan/work/lsp-dap/vscode-extension/src/test/setup.test.ts`
3. `/Users/stefan/work/lsp-dap/vscode-extension/src/extension.ts`
4. `/Users/stefan/work/lsp-dap/vscode-extension/package.json`
5. `/Users/stefan/work/lsp-dap/scaffold_test.go`
