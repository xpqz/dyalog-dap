# PR Description - Issue #6

Issue: #6 - Add timestamped protocol traffic logging for diagnostics  
Branch: codex/6-add-timestamped-protocol-traffic-logging-for-diagnostics  
Plan reference: /Users/stefan/work/lsp-dap/docs/plans/ride-protocol.md (section 10)

## Summary

This change adds structured, timestamped protocol traffic logging to the RIDE transport layer for both outbound and inbound payloads. Logging is opt-in and designed to be easy to enable in tests/integration harnesses by attaching a logger to the transport client.

## Why this change

The plan requires timestamped protocol logs for diagnostics in integration runs. Without this, debugging ordering-sensitive flows (prompt transitions, tracer control, save/close sequencing) is significantly harder.

## Scope of changes

Files changed:

- /Users/stefan/work/lsp-dap/internal/ride/transport/traffic_log.go
- /Users/stefan/work/lsp-dap/internal/ride/transport/client.go
- /Users/stefan/work/lsp-dap/internal/ride/transport/client_test.go

Implemented in `traffic_log.go`:

- `TrafficDirection` enum-like type:
  - `DirectionInbound`
  - `DirectionOutbound`
- `TrafficLogEntry` structured record with:
  - `timestamp`
  - `direction`
  - `payload`
- `TrafficLogger` interface:
  - `LogTraffic(direction, payload)`
- `JSONLTrafficLogger`:
  - writes one JSON object per line (JSONL)
  - uses UTC timestamps
  - mutex-protected writes for concurrent safety

Implemented in `client.go`:

- added `trafficLogger` to `Client`
- added `SetTrafficLogger(logger TrafficLogger)` for opt-in enablement
- `WritePayload` now emits an outbound log entry after successful write
- `ReadPayload` now emits an inbound log entry after successful decode

## Test coverage

Added/updated tests in `/Users/stefan/work/lsp-dap/internal/ride/transport/client_test.go`:

- `TestWritePayload_LogsOutgoingTrafficWhenEnabled`
- `TestReadPayload_LogsIncomingTrafficWhenEnabled`
- `TestJSONLTrafficLogger_WritesStructuredLine`

These tests verify:

- logging is emitted with direction + payload + timestamp
- both traffic directions are captured
- JSONL logger output is structured and decodable

## Validation performed

Commands run:

- `go test ./...`
- `go vet ./...`

Result:

- all tests pass
- vet clean

## Compatibility and risk

Behavioral characteristics:

- logging is opt-in; existing transport behavior is unchanged unless a logger is configured
- log emission currently happens synchronously on read/write path

Known limitations in this PR:

- logger interface does not surface encode/write errors
- no built-in file rotation policy (left to integration harness/environment)

## Out of scope

Not part of this PR:

- automatic log-file lifecycle management
- integration harness plumbing (covered by later testing issues)

## Reviewer guide

Suggested review order:

1. `/Users/stefan/work/lsp-dap/internal/ride/transport/client_test.go`
2. `/Users/stefan/work/lsp-dap/internal/ride/transport/traffic_log.go`
3. `/Users/stefan/work/lsp-dap/internal/ride/transport/client.go`
