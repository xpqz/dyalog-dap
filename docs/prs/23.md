# PR Description - Issue #23

Issue: #23 - Implement interrupt strategy with WeakInterrupt and StrongInterrupt fallback  
Branch: codex/23-implement-interrupt-strategy-with-weakinterrupt-and-stronginterrupt-fallback  
Plan reference: /Users/stefan/work/lsp-dap/docs/plans/ride-protocol.md (section 9 and open questions)

## Summary

This change upgrades pause handling in the DAP adapter to a multi-stage interrupt strategy: `WeakInterrupt` first, `StrongInterrupt` fallback on weak failure, then optional external fallback hook. It also adds response telemetry indicating which strategy succeeded.

## Why this change

Single-path interrupt logic is fragile when weak interrupts fail under certain runtime conditions. The plan calls for an explicit fallback strategy to improve pause reliability.

## Scope of changes

Files changed:

- /Users/stefan/work/lsp-dap/internal/dap/adapter/server.go
- /Users/stefan/work/lsp-dap/internal/dap/adapter/server_test.go

Implemented in `server.go`:

- Added `PauseResponseBody` with `interruptMethod` telemetry.
- Updated `pause` control command handling:
  - try `WeakInterrupt`
  - if weak fails, try `StrongInterrupt`
  - if both fail, try configured fallback hook
  - return success telemetry with method `weak`/`strong`/`fallback`
- Added helper `successWithBody` for response construction.

Implemented in `server_test.go`:

- updated `TestHandleRequest_PauseUsesWeakInterrupt` to assert telemetry
- added `TestHandleRequest_PauseWeakInterruptFailureUsesStrongInterrupt`
- updated fallback-hook test to assert telemetry
- enhanced mock ride controller with command-specific send error injection and call capture for failed sends

## Test coverage

Pause path now has explicit regression coverage for:

- weak success
- weak failure + strong success
- weak+strong failure + fallback hook success

## Validation performed

Commands run:

- `gofmt -w internal/dap/adapter/server.go internal/dap/adapter/server_test.go`
- `go test ./internal/dap/adapter -count=1`
- `go test ./... -count=1`
- `go vet ./...`

Result:

- all tests pass
- vet clean

## Compatibility and risk

Behavior notes:

- pause handling is now more resilient under weak interrupt failure
- successful strategy is surfaced in DAP response body for telemetry/debugging

Known limitations in this PR:

- failed fallback-hook error details are still collapsed into generic pause failure messaging

## Out of scope

Not part of this PR:

- adaptive strategy selection based on runtime signal history
- client-facing structured telemetry event stream beyond pause response body

## Reviewer guide

Suggested review order:

1. `/Users/stefan/work/lsp-dap/internal/dap/adapter/server_test.go`
2. `/Users/stefan/work/lsp-dap/internal/dap/adapter/server.go`
