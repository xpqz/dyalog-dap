# PR Description - Issue #15

Issue: #15 - Implement `setBreakpoints` translation to `SetLineAttributes`  
Branch: codex/15-implement-setbreakpoints-translation-to-setlineattributes  
Plan reference: /Users/stefan/work/lsp-dap/docs/plans/ride-protocol.md (sections 4, 9, and 10)

## Summary

This change wires DAP `setBreakpoints` into the adapter by resolving DAP sources to active RIDE window tokens and emitting `SetLineAttributes` with translated 0-based stop lines.

## Why this change

Breakpoint support is a core debugger path. The RIDE protocol is token/window-centric, while DAP is file/source-centric, so this issue implements the translation bridge identified in the plan.

## Scope of changes

Files changed:

- /Users/stefan/work/lsp-dap/internal/dap/adapter/server.go
- /Users/stefan/work/lsp-dap/internal/dap/adapter/server_test.go

Implemented in `server.go`:

- Added DAP response models for breakpoints:
  - `Breakpoint`
  - `SetBreakpointsResponseBody`
- Added `setBreakpoints` dispatch in `HandleRequest`.
- Added `handleSetBreakpointsRequest` with behavior:
  - validates adapter session state and RIDE controller availability
  - parses `source.path` or `source.sourceReference`
  - parses breakpoint lines from `breakpoints[]` (and tolerates `lines[]` form)
  - resolves source -> active RIDE token via existing source/token registry
  - when token is found: sends `SetLineAttributes` with `stop` (0-based), `monitor=[]`, `trace=[]`
  - when token is not mapped: returns success with unverified breakpoints and does not send RIDE command
- Added helpers for parsing, token resolution, line conversion, and response construction.

## Test coverage

Extended `/Users/stefan/work/lsp-dap/internal/dap/adapter/server_test.go` with:

- `TestHandleRequest_SetBreakpointsTranslatesLinesAndSendsSetLineAttributes`
- `TestHandleRequest_SetBreakpointsSupportsSourceReferenceLookup`
- `TestHandleRequest_SetBreakpointsUnverifiedWhenSourceNotMapped`

These tests verify line translation, sourceReference lookup, token routing, and graceful unmapped-source behavior.

## Validation performed

Commands run:

- `gofmt -w internal/dap/adapter/server.go internal/dap/adapter/server_test.go`
- `go test ./internal/dap/adapter -count=1`
- `go test ./... -count=1`
- `go vet ./...`

Result:

- all tests pass
- vet clean

## Compatibility and risk

Behavior notes:

- DAP breakpoint verification currently reflects token resolvability at request time.
- Unknown/unmapped sources return unverified breakpoints without failing the request.

Known limitations in this PR:

- No pending-breakpoint queue for sources that are not yet opened in RIDE.
- No persistence flow via `SaveChanges` yet; this PR focuses on immediate debugger-session application.

## Out of scope

Not part of this PR:

- function/conditional/hit-count breakpoint features
- source content loading (`source` DAP request)
- breakpoint rehydration on reconnect/session restart

## Reviewer guide

Suggested review order:

1. `/Users/stefan/work/lsp-dap/internal/dap/adapter/server_test.go`
2. `/Users/stefan/work/lsp-dap/internal/dap/adapter/server.go`
