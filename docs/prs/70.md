# PR Description - Issue #70

Issue: #70 - Create shared decode utility and migrate duplicate adapter/runtime helpers  
Branch: codex/70-shared-decode-utility-migrate-adapter-runtime-helpers  
Plan reference: /Users/stefan/work/lsp-dap/docs/plans/refactor.md (Phase 2: consolidate decode helpers)  
Context references: /Users/stefan/work/lsp-dap/docs/plans/refactor.md, parent phase #66, parent epic #64

## Summary

This change introduces a shared internal decode utility package and migrates runtime/adapter/protocol conversion paths to use it, removing duplicated local conversion logic.

## Why this change

Issue #70 targets duplicate decode/getter logic across `cmd/dap-adapter`, `internal/dap/adapter`, and `internal/ride/protocol`, reducing drift risk and concentrating conversion behavior in one tested location.

## Scope of changes

Files changed:

- `/Users/stefan/work/lsp-dap/internal/support/decode/decode.go`
- `/Users/stefan/work/lsp-dap/internal/support/decode/decode_test.go`
- `/Users/stefan/work/lsp-dap/cmd/dap-adapter/main.go`
- `/Users/stefan/work/lsp-dap/internal/ride/protocol/codec.go`
- `/Users/stefan/work/lsp-dap/internal/dap/adapter/server.go`

### Shared utility package

Added `internal/support/decode` with reusable helpers for:

- string extraction (raw and non-empty trimmed)
- int extraction (numeric and numeric-or-text variants)
- bool normalization from bool/0/1 forms
- string/int slice extraction from dynamic payloads
- map-based helper wrappers for common `map[string]any` access paths

### Runtime/protocol/adapter migration

- `cmd/dap-adapter/main.go` now uses shared decode helpers for launch/attach argument parsing
- `internal/ride/protocol/codec.go` now routes core decode primitives through shared helpers
- `internal/dap/adapter/server.go` conversion helpers now delegate to shared helpers

## Validation performed

Commands run:

- `go test ./internal/support/decode ./internal/ride/protocol ./internal/dap/adapter ./cmd/dap-adapter -count=1`
- `go test ./... -count=1`
- `go vet ./...`

Result:

- all checks pass

## Compatibility and risk

Behavioral impact:

- no intentional protocol or runtime behavior changes; migration preserves existing conversion semantics

Risk:

- low-to-moderate. Conversion centralization can affect multiple paths; mitigated by package tests and full suite pass.

## Reviewer guide

Suggested review order:

1. `/Users/stefan/work/lsp-dap/internal/support/decode/decode.go`
2. `/Users/stefan/work/lsp-dap/internal/support/decode/decode_test.go`
3. `/Users/stefan/work/lsp-dap/cmd/dap-adapter/main.go`
4. `/Users/stefan/work/lsp-dap/internal/ride/protocol/codec.go`
5. `/Users/stefan/work/lsp-dap/internal/dap/adapter/server.go`
