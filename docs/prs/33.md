# PR Description - Issue #33

Issue: #33 - Define CI test matrix and gating for unit/integration/DAP suites  
Branch: codex/33-define-ci-test-matrix-and-gating-for-unit-integration-dap-suites  
Plan reference: /Users/stefan/work/lsp-dap/docs/plans/ride-protocol.md (section 10)

## Summary

This change introduces a CI workflow with explicit gating strategy:

- mandatory critical protocol/adapter integration test gate across Go version matrix
- mandatory full-suite + vet gate
- optional live-Dyalog job that runs only when endpoint configuration is provided

It also adds scaffold regression checks for workflow presence/content.

## Why this change

The project needed deterministic CI gating for critical protocol behavior while supporting environments where live Dyalog is unavailable.

## Scope of changes

Files changed:

- /Users/stefan/work/lsp-dap/.github/workflows/ci.yml
- /Users/stefan/work/lsp-dap/scaffold_test.go

Implemented CI strategy in `ci.yml`:

- `critical-gate` job (Go matrix `1.22.x`, `1.23.x`):
  - runs critical suites:
    - `internal/ride/protocol`
    - `internal/ride/sessionstate`
    - `internal/dap/adapter`
    - `internal/integration/harness`
- `full-suite` job (needs `critical-gate`):
  - runs `go test ./...`
  - runs `go vet ./...`
- `live-dyalog` job (needs `critical-gate`, optional):
  - runs only if `vars.DYALOG_RIDE_ADDR` is configured
  - consumes `DYALOG_RIDE_*` vars for live endpoint execution

Implemented scaffold regression check:

- `TestScaffold_HasCIWorkflowWithCriticalAndLiveJobs`
  - validates workflow presence and required snippets (`critical-gate`, `live-dyalog`, `DYALOG_RIDE_ADDR`, full-suite test run)

## Test coverage

Added scaffold-level test protection so CI strategy regressions are caught by local/CI test runs.

## Validation performed

Commands run:

- `go test ./... -count=1`
- `go vet ./...`

Result:

- all tests pass
- vet clean

## Compatibility and risk

Behavior notes:

- critical protocol behavior is now explicitly gated in CI before broader suite execution
- live-Dyalog behavior is clearly optional and non-blocking when endpoint config is absent

Known limitations in this PR:

- live job currently reuses harness tests and depends on externally provisioned RIDE endpoint variables

## Out of scope

Not part of this PR:

- secrets/endpoint provisioning policy for each CI environment
- artifact publishing for transcripts or coverage reports

## Reviewer guide

Suggested review order:

1. `/Users/stefan/work/lsp-dap/.github/workflows/ci.yml`
2. `/Users/stefan/work/lsp-dap/scaffold_test.go`
