# PR Description - Issue #72

Issue: #72 - Extract runtime config + DAP transport from cmd/dap-adapter/main.go  
Branch: codex/72-extract-runtime-config-and-dap-transport-from-main  
Plan reference: /Users/stefan/work/lsp-dap/docs/plans/refactor.md (Phase 3: runtime/config/transport extraction)  
Context references: /Users/stefan/work/lsp-dap/docs/plans/refactor.md, parent phase #67, parent epic #64

## Summary

This change extracts DAP framing and runtime launch/attach config parsing from `cmd/dap-adapter/main.go` into dedicated internal packages, preserving existing behavior through compatibility wrappers in `main.go`.

## Why this change

Issue #72 targets clearer ownership boundaries in the adapter entrypoint by isolating transport and runtime-config concerns into focused packages.

## Scope of changes

Files changed:

- `/Users/stefan/work/lsp-dap/cmd/dap-adapter/main.go`
- `/Users/stefan/work/lsp-dap/internal/dap/transport/stdio.go`
- `/Users/stefan/work/lsp-dap/internal/dap/transport/stdio_test.go`
- `/Users/stefan/work/lsp-dap/internal/runtime/config/config.go`
- `/Users/stefan/work/lsp-dap/internal/runtime/config/config_test.go`

### Transport extraction

- added `internal/dap/transport` with `ReadPayload` and `WritePayload`
- `cmd/dap-adapter/main.go` now delegates read/write wrappers to shared transport package

### Runtime config extraction

- added `internal/runtime/config` with `FromRequest` for launch/attach argument parsing
- `cmd/dap-adapter/main.go` now delegates `runtimeConfigFrom` to this package

### Tests

- added direct unit coverage for new transport package
- added direct unit coverage for new runtime config package
- existing adapter command tests continue to validate wrapper compatibility

## Validation performed

Commands run:

- `go test ./internal/dap/transport ./internal/runtime/config ./cmd/dap-adapter -count=1`
- `go test ./... -count=1`
- `go vet ./...`

Result:

- all checks pass

## Compatibility and risk

Behavioral impact:

- no intended behavior change; entrypoint API and existing wrappers remain stable

Risk:

- low. Main risk is extraction drift in framing/config edge cases; mitigated by package tests and existing command tests.

## Reviewer guide

Suggested review order:

1. `/Users/stefan/work/lsp-dap/internal/dap/transport/stdio.go`
2. `/Users/stefan/work/lsp-dap/internal/dap/transport/stdio_test.go`
3. `/Users/stefan/work/lsp-dap/internal/runtime/config/config.go`
4. `/Users/stefan/work/lsp-dap/internal/runtime/config/config_test.go`
5. `/Users/stefan/work/lsp-dap/cmd/dap-adapter/main.go`
