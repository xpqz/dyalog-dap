# PR Description - Issue #39

Issue: #39 - Add stdio end-to-end DAP session integration tests  
Branch: codex/39-add-stdio-end-to-end-dap-session-integration-tests  
Plan reference: /Users/stefan/work/lsp-dap/docs/plans/ride-protocol.md (section 10)

## Summary

This change expands process-boundary DAP integration coverage for `cmd/dap-adapter` with:

- a fuller deterministic stdio session flow (`initialize -> launch -> setBreakpoints -> configurationDone -> step/continue -> disconnect`)
- an env-gated live stdio DAP smoke test against real Dyalog
- CI live job coverage for both harness-level and adapter-stdio-level live tests

## Why this change

We had partial stdio coverage already, but issue scope required explicit phase flow coverage and a live path for the adapter process boundary itself (not just harness runtime tests).

## Scope of changes

Files changed:

- `/Users/stefan/work/lsp-dap/cmd/dap-adapter/main_test.go`
- `/Users/stefan/work/lsp-dap/cmd/dap-adapter/live_stdio_test.go`
- `/Users/stefan/work/lsp-dap/.github/workflows/ci.yml`
- `/Users/stefan/work/lsp-dap/README.md`

### `cmd/dap-adapter/main_test.go`

Updated deterministic fake-RIDE stdio flow:

- validates `configurationDone` response after breakpoints are set
- validates `continue` response and mapped outbound RIDE `Continue` command
- keeps existing checks for:
  - startup handshake sequence
  - threads polling (`GetThreads`)
  - step mapping (`RunCurrentLine`)
  - breakpoint translation (`SetLineAttributes` stop line conversion)

### `cmd/dap-adapter/live_stdio_test.go`

Added env-gated live adapter test:

- `TestLiveDAPAdapter_InitializeLaunchThreadsDisconnect`
  - runs full adapter stdio loop in-process
  - drives real DAP framed requests (`initialize`, `launch`, `threads`, `disconnect`)
  - launches/attaches to real Dyalog based on `DYALOG_RIDE_*` env (and optional `DYALOG_BIN`)
  - skips when not configured unless `DYALOG_LIVE_REQUIRE=1`

### `.github/workflows/ci.yml`

Extended optional `live-dyalog` job:

- continues to run harness live tests
- now also runs cmd-level live stdio adapter test:
  - `go test ./cmd/dap-adapter -run '^TestLiveDAPAdapter_' -count=1 -v`

### `README.md`

Updated live testing docs:

- added live stdio adapter smoke command
- updated CI strategy note to include `TestLiveDAPAdapter_*`

## Test coverage

Coverage now spans:

- deterministic fake-server stdio process-boundary flows including configurationDone/continue
- real live interpreter stdio adapter smoke path under env-gated conditions

## Validation performed

Commands run:

- `go test ./cmd/dap-adapter -count=1`
- `go test ./... -count=1`
- `go vet ./...`

Result:

- all tests pass
- vet clean

## Compatibility and risk

Behavior changes:

- no production runtime behavior changes; this is coverage/docs/CI expansion

Risks:

- live CI execution remains dependent on external endpoint/provisioning reliability

## Out of scope

Not included in this PR:

- richer live scenario matrix beyond smoke-level session lifecycle
- debugger UI automation in VS Code host

## Reviewer guide

Suggested review order:

1. `/Users/stefan/work/lsp-dap/cmd/dap-adapter/main_test.go`
2. `/Users/stefan/work/lsp-dap/cmd/dap-adapter/live_stdio_test.go`
3. `/Users/stefan/work/lsp-dap/.github/workflows/ci.yml`
4. `/Users/stefan/work/lsp-dap/README.md`
