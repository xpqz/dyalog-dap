# PR Description - Issue #9

Issue: #9 - Map DAP continue/next/stepIn/stepOut/pause to RIDE controls  
Branch: codex/9-map-dap-continue-next-stepin-stepout-pause-to-ride-controls  
Plan reference: /Users/stefan/work/lsp-dap/docs/plans/ride-protocol.md (sections 4 and 9)

## Summary

This change extends the DAP adapter server skeleton to map control requests (`continue`, `next`, `stepIn`, `stepOut`, `pause`) into RIDE debugger commands.

Implemented mappings:

- `continue` -> `Continue`
- `next` -> `RunCurrentLine`
- `stepIn` -> `StepInto`
- `stepOut` -> `ContinueTrace`
- `pause` -> `WeakInterrupt` with optional fallback hook

## Why this change

The phase-1 plan requires a concrete control path from DAP stepping requests to RIDE tracer controls. This PR establishes the mapping boundary and required runtime guards before thread/frame/event plumbing is added.

## Scope of changes

Files changed:

- /Users/stefan/work/lsp-dap/internal/dap/adapter/server.go
- /Users/stefan/work/lsp-dap/internal/dap/adapter/server_test.go

Implemented in `server.go`:

- `RideCommandSender` interface for outbound RIDE command dispatch
- server injection/config hooks:
  - `SetRideController(...)`
  - `SetActiveTracerWindow(win int)`
  - `SetPauseFallback(func() error)`
- control command handler path in `HandleRequest` for:
  - `continue`
  - `next`
  - `stepIn`
  - `stepOut`
  - `pause`
- lifecycle and safety checks:
  - control commands require launched/attached session state
  - step/continue commands require an active tracer window
  - control commands fail fast if no RIDE controller is configured
- pause fallback behavior:
  - tries `WeakInterrupt`
  - if weak interrupt fails and fallback hook exists, executes fallback hook

## Test coverage

Extended `/Users/stefan/work/lsp-dap/internal/dap/adapter/server_test.go` with:

- `TestHandleRequest_ContinueMapsToRideContinue`
- `TestHandleRequest_StepCommandsMapToRideCommands`
- `TestHandleRequest_PauseUsesWeakInterrupt`
- `TestHandleRequest_PauseWeakInterruptFailureUsesFallbackHook`
- `TestHandleRequest_ControlCommandsRequireActiveTracerWindow`

These tests validate command mapping, lifecycle preconditions, tracer-window requirements, and pause fallback hook behavior.

## Validation performed

Commands run:

- `go test ./...`
- `go vet ./...`

Result:

- all tests pass
- vet clean

## Compatibility and risk

Behavior notes:

- control mapping is now explicit and test-covered
- fallback strategy is intentionally hook-based so policy can evolve without changing command mapping API

Known limitations in this PR:

- no DAP request-argument parsing beyond command routing yet
- no thread-specific control target selection yet (active tracer window is server state)
- no outbound retry/queue policy at DAP layer (delegated to lower RIDE layers)

## Out of scope

Not part of this PR:

- stopped event emission and reason modeling
- threads and stackTrace request handling
- source/breakpoint mapping

## Reviewer guide

Suggested review order:

1. `/Users/stefan/work/lsp-dap/internal/dap/adapter/server_test.go`
2. `/Users/stefan/work/lsp-dap/internal/dap/adapter/server.go`
