# PR Description - Issue #60

Issue: #60 - Add VS Code Extension Host integration tests for extension workflows  
Branch: codex/60-add-vs-code-extension-host-integration-tests-for-extension-workflows  
Plan reference: /Users/stefan/work/lsp-dap/docs/plans/ride-protocol.md (test strategy and real-client validation emphasis)  
Context references: /Users/stefan/work/lsp-dap/vscode-extension/README.md, /Users/stefan/work/lsp-dap/docs/reviews/57.md, parent epic #58

## Summary

This change adds a real VS Code Extension Host test harness and CI workflow, including an integration test that activates the extension and executes the diagnostic bundle command end-to-end.

## Why this change

Existing extension tests validated behavior with stubs. Issue #60 requires runtime validation in actual Extension Host execution to catch regressions in command registration, activation, and workspace artifact emission.

## Scope of changes

Files changed:

- `/Users/stefan/work/lsp-dap/vscode-extension/package.json`
- `/Users/stefan/work/lsp-dap/vscode-extension/package-lock.json`
- `/Users/stefan/work/lsp-dap/vscode-extension/src/test/exthost/runTest.ts`
- `/Users/stefan/work/lsp-dap/vscode-extension/src/test/exthost/suite/index.ts`
- `/Users/stefan/work/lsp-dap/vscode-extension/src/test/exthost/suite/diagnosticBundle.exthost.test.ts`
- `/Users/stefan/work/lsp-dap/.github/workflows/vscode-extension-host.yml`
- `/Users/stefan/work/lsp-dap/vscode-extension/README.md`
- `/Users/stefan/work/lsp-dap/scaffold_test.go`
- `/Users/stefan/work/lsp-dap/.gitignore`

### Extension Host harness

Added `test:exthost` script and harness files:

- launches VS Code test runtime via `@vscode/test-electron`
- opens an isolated temp workspace
- runs integration suite entrypoint

### Diagnostic bundle Extension Host test

Added test that:

- activates extension `xpqz.dyalog-dap`
- executes `dyalogDap.generateDiagnosticBundle` through VS Code command API
- validates emitted support artifact and key bundle sections
- verifies sensitive environment field redaction

### CI workflow

Added `.github/workflows/vscode-extension-host.yml`:

- runs on push to `main` and pull requests
- installs extension dependencies via `npm ci`
- runs Extension Host tests headlessly with `xvfb-run -a npm run test:exthost`

### Documentation and scaffold guard

- updated extension README with local/CI instructions for Extension Host tests
- added scaffold test enforcing presence of harness, workflow, and docs cues

## Validation performed

Commands run:

- `go test ./... -count=1`
- `go vet ./...`
- `cd vscode-extension && npm run lint`
- `cd vscode-extension && npm test -- --runInBand`
- `cd vscode-extension && npm run test:exthost`
- `cd vscode-extension && npm run build`

Result:

- all checks pass

## Compatibility and risk

Behavioral impact:

- test/CI/docs only; no adapter runtime behavior changes

Risk:

- low-to-moderate CI runtime sensitivity due VS Code download/runtime startup; mitigated by deterministic harness and headless runner usage.

## Reviewer guide

Suggested review order:

1. `/Users/stefan/work/lsp-dap/vscode-extension/src/test/exthost/runTest.ts`
2. `/Users/stefan/work/lsp-dap/vscode-extension/src/test/exthost/suite/diagnosticBundle.exthost.test.ts`
3. `/Users/stefan/work/lsp-dap/.github/workflows/vscode-extension-host.yml`
4. `/Users/stefan/work/lsp-dap/vscode-extension/README.md`
5. `/Users/stefan/work/lsp-dap/scaffold_test.go`
